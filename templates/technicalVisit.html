<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Technical Visit</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
      <a class="navbar-brand" href="home">EMTech</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="home">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="technicalVisit">Technical Visit</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="attachments">Attachments</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="admin">Admin</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <!-- --------------------------------- -->
  <div class="container">
    <h1 style="text-align: center;">Customer Data</h1>
    <form id="formData">
        <div class="row mb-3">
            <label for="name" class="col-sm-2 col-form-label">Customer:</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="name" required>
            </div>
        </div>
        <div class="row mb-3">
            <label for="location" class="col-sm-2 col-form-label">Location:</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="location">
            </div>
        </div>
        <div class="row mb-3">
            <label for="phone" class="col-sm-2 col-form-label">Phone:</label>
            <div class="col-sm-10">
                <input type="number" class="form-control" id="phone">
            </div>
        </div>
        <fieldset class="row mb-3">
            <legend class="col-form-label col-sm-2 pt-0">Visit Data Engineer:</legend>
            <div class="col-sm-10">
                <div class="row" id="engineers-checkboxes"></div>
            </div>
        </fieldset>
        <fieldset class="row mb-3">
            <legend class="col-form-label col-sm-2 pt-0">Visit/Project:</legend>
            <div class="col-sm-10 row">
                <div class="form-check col-sm-5">
                    <input class="form-check-input" type="checkbox" name="visitProject" id="visit" value="Visit">
                    <label class="form-check-label" for="visit">
                        Visit
                    </label>
                </div>
                <div class="form-check col-sm-5">
                    <input class="form-check-input" type="checkbox" name="visitProject" id="project" value="Project">
                    <label class="form-check-label" for="project">
                        Project
                    </label>
                </div>
            </div>
        </fieldset>
        <div class="row mb-3">
            <label for="date" class="col-sm-2 col-form-label">Start Date:</label>
            <div class="col-sm-10">
                <input type="date" class="form-control" id="date" required>
            </div>
        </div>
        <fieldset class="row mb-3">
            <legend class="col-form-label col-sm-2 pt-0">Status:</legend>
            <div class="col-sm-10">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="gridRadios" id="done" value="Done">
                    <label class="form-check-label" for="done">
                        Done
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="gridRadios" id="in" value="In Progress">
                    <label class="form-check-label" for="in">
                        In Progress
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="gridRadios" id="hold" value="Hold">
                    <label class="form-check-label" for="hold">
                        Hold
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="gridRadios" id="lead" value="Lead">
                    <label class="form-check-label" for="lead">
                        Lead
                    </label>
                </div>
            </div>
        </fieldset>
        <div class="mb-3">
            <label for="formFileMultiple" class="form-label">Attachment:</label>
            <input class="form-control" type="file" id="formFileMultiple">
        </div>
        <div class="row mb-3">
            <label for="attachname" class="col-sm-2 col-form-label">Name:</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="attachname">
            </div>
        </div>
        <div class="row mb-3">
            <label for="desc" class="col-sm-2 col-form-label">Description:</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="desc">
            </div>
        </div>
        <div class="d-grid gap-2 col-6 mx-auto">
            <button type="submit" class="btn btn-primary btn-lg">Save</button>
        </div>
    </form><br>
    <table id="dataTable" class="table  table-striped table-primary">
        <thead>
            <tr>
                <th>Customer Name</th>
                <th>Location</th>
                <th>Phone</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>
</div>
<div class="container mt-4 d-none">
    <div id="attachmentsContainer" class="row"></div>
</div>
  <!-- ------------------------------ -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
    crossorigin="anonymous"></script>

     <script>
      function publishToTable() {
          const name = document.getElementById('name').value;
          const location = document.getElementById('location').value;
          const phone = document.getElementById('phone').value;
          const fileInput = document.getElementById("formFileMultiple");
          const attachName = document.getElementById("attachname").value;
          const description = document.getElementById("desc").value;
          const visitEngineers = Array.from(document.querySelectorAll('input[name="visitEngineer"]:checked')).map(cb => cb.value);
          const visitProjects = Array.from(document.querySelectorAll('input[name="visitProject"]:checked')).map(cb => cb.value);
          const statusElements = document.querySelectorAll('input[name="gridRadios"]:checked');
          let status = "";
          statusElements.forEach((element) => {
              status = element.value;
          });

          if (name && visitEngineers.length > 0 && visitProjects.length > 0 && status) {
              const reader = new FileReader();
              reader.onload = function (e) {
                  const data = {
                      name: name,
                      location: location || "", // Optional field
                      phone: phone || "", // Optional field
                      visitEngineers: visitEngineers,
                      visitProjects: visitProjects,
                      status: status,
                      fileAttach: fileInput.files.length > 0 ? e.target.result : "", // Optional field
                      attachName: attachName || "", // Optional field
                      description: description || "" // Optional field
                  };

                  let existingData = JSON.parse(localStorage.getItem('formDataArray')) || [];
                  existingData.push(data);
                  localStorage.setItem('formDataArray', JSON.stringify(existingData));

                  const tableElement = document.getElementById('dataTable');
                  const trElement = document.createElement('tr');
                  const nameEle = document.createElement('td');
                  const locationEle = document.createElement('td');
                  const phoneEle = document.createElement('td');
                  nameEle.innerHTML = name;
                  locationEle.innerHTML = location;
                  phoneEle.innerHTML = phone;
                  trElement.appendChild(nameEle);
                  trElement.appendChild(locationEle);
                  trElement.appendChild(phoneEle);
                  tableElement.querySelector('tbody').appendChild(trElement);

                  if (fileInput.files.length > 0) {
                      addAttachmentToPage(data);
                  }
              };

              if (fileInput.files.length > 0) {
                  reader.readAsDataURL(fileInput.files[0]);
              } else {
                  // Call the onload function directly if no file is selected
                  reader.onload({ target: { result: "" } });
              }
          }
      }

      function addAttachmentToPage(data) {
          if (data.fileAttach) {
              const cardDiv = document.createElement("div");
              cardDiv.classList.add("col");
              cardDiv.innerHTML = `
                  <div class="card">
                      <img src="${data.fileAttach}" class="card-img-top" alt="${data.attachName}">
                      <div class="card-body">
                          <h5 class="card-title">${data.attachName}</h5>
                          <p class="card-text">${data.description}</p>
                      </div>
                  </div>
              `;
              document.getElementById('attachmentsContainer').appendChild(cardDiv);
          }
      }

      document.getElementById("formData").addEventListener("submit", function (event) {
          event.preventDefault();
          publishToTable();
      });

      document.addEventListener('DOMContentLoaded', (event) => {
        const engineers = JSON.parse(localStorage.getItem('engineers')) || [];
        const container = document.getElementById('engineers-checkboxes');
        if (engineers.length > 0) {
            engineers.forEach((engineer, index) => {
                if (index % 2 === 0) {
                    rowDiv = document.createElement('div');
                    rowDiv.className = 'row mb-3';
                    container.appendChild(rowDiv);
                }

                const colDiv = document.createElement('div');
                colDiv.className = 'col-md-5';

                const div = document.createElement('div');
                div.className = 'form-check';

                const input = document.createElement('input');
                input.type = 'checkbox';
                input.className = 'form-check-input';
                input.id = engineer;
                input.name = 'visitEngineer';
                input.value = engineer;

                const label = document.createElement('label');
                label.className = 'form-check-label';
                label.setAttribute('for', engineer);
                label.textContent = engineer;

                div.appendChild(input);
                div.appendChild(label);
                colDiv.appendChild(div);
                rowDiv.appendChild(colDiv);
            });
        }

        const existingData = JSON.parse(localStorage.getItem('formDataArray')) || [];
        existingData.forEach(data => {
            const trElement = document.createElement('tr');
            const nameEle = document.createElement('td');
            const locationEle = document.createElement('td');
            const phoneEle = document.createElement('td');
            nameEle.innerHTML = data.name;
            locationEle.innerHTML = data.location;
            phoneEle.innerHTML = data.phone;
            trElement.appendChild(nameEle);
            trElement.appendChild(locationEle);
            trElement.appendChild(phoneEle);
            document.getElementById('dataTable').querySelector('tbody').appendChild(trElement);

            if (data.fileAttach) {
                addAttachmentToPage(data);
            }
        });
    });
    </script>


</body>

</html>